// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  privyId       String       @unique
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  onboarding    Onboarding?
  groceryItems  GroceryItem[]
  receipts      Receipt[]
}

model Onboarding {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  completed     Boolean  @default(false)
  householdType String?
  householdMembers Int?
  goals         String[] // Array of goal strings
  diet          String?
  ingredients   String[] // Array of ingredient preference strings
  monthlyBudget String?
  weeklyBudget  String?
  dataSources   Json?    // Store dataSources object
  storageMode   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model GroceryItem {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  quantity    String?
  daysLeft    Int?
  status      String   @default("ok") // ok, low, out
  health      String   @default("clean") // clean, flagged
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

model Receipt {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  imageUrl    String?       // URL or path to stored image
  store       String?
  date        DateTime?
  total       Float?
  processed   Boolean       @default(false) // Whether items have been added to inventory
  items       ReceiptItem[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([userId])
}

model ReceiptItem {
  id          String   @id @default(cuid())
  receiptId   String
  receipt     Receipt  @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  name        String
  quantity    String?
  price       Float?
  category    String?
  createdAt   DateTime @default(now())

  @@index([receiptId])
}
